---
title: "Prepare a table for flow accumulation parameters, beta_i and gamma parameters"
---
# Objective

+ To prepare a table that contains flow accumulation parameters, beta_i and gamma parameters, for all the watersheds in the study regions. These parameters are required inputs for the InVEST SWY model. In each run of the SWY model, the values of flow accumulation, beta_i and gamma parameters are retrieved from this table based on the HYBAS_ID of the watershed.

```{r}
library(here)
i_am("Scr/Code/PrepData/Parameters/x_Prep_param_table.qmd")
```

# Create Parameter Table

```{r}
# === Flow Accumulation Table === #
flow_acc_tbl <- 
  readRDS(here(int_dir, "FlowAcc/flow_acc_tbl_global.rds")) %>%
  .[, c("region", "hybas_id") := tstrsplit(id, "_")] %>%
  .[, `:=`(
    id = NULL,
    hybas_id = as.numeric(hybas_id)
  )]


# === beta_i and gamma parameters === #
beta_gamma_tbl <-
  list.files(
    file.path(param_dir),
    pattern = "^beta_gamma_.*\\.rds$",
    full.names = TRUE
  ) %>%
  lapply(readRDS) %>%
  rbindlist() %>%
  .[, na_beta_gamma := is.na(beta_i) | is.na(gamma)]


# === Combine === #
param_tbl <- 
  merge(flow_acc_tbl, beta_gamma_tbl, by = c("region", "hybas_id"), all = TRUE) %>%
  .[, param_available := !is.na(t_fac_q50) & !na_beta_gamma]

param_tbl[, 
  .(n_total = .N,
    n_param_available = sum(param_available),
    n_param_unavailable = sum(!param_available)
  ), by = region]


saveRDS(
  param_tbl,
  here(int_dir, "SWY_inputs/0_param_tbl.rds")
)
```